
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Monster Storm - D W</title>
  <meta name="author" content="Harry">

  
  <meta name="description" content="Monster Storm 边学边写的cocos2d-x游戏,基于3.0版本 这个游戏的主要难点有两个
1. 怎么把所有需要消除的精灵摆对位置
2. 怎么找到某个精灵周围的同类精灵 摆放精灵 找到精灵摆放点的左下角的(x,y)坐标,这里直接借用泰然网教程上说的 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://d-w-.github.io/blog/2015/03/25/Monster-Storm">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="D W" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <script src="/javascripts/dawnfan.js" type="text/javascript"></script>
  <script src="/javascripts/jquery.nicescroll.min.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   class="no-sidebar"  >
  <header role="banner"><a id="avatar" href="/about"><img src="/images/icon.jpg" alt="avatar"></a>
<div class="header-left">
  <hgroup>
  <h1><a href="/">D W</a></h1>
  
  <div class="subtitle">
    <h2>Brick walls are there for a reason, they let us prove how badly we want things.</h2>
  </div>
  
  </hgroup>
  
</div>

<div class="header-right">
  <ul class="main-navigation">
 <div> 
  <li><a href="/">blog</a></li></div>
         <div> 
  <li><a href="/blog/archives">archives</a></li></div>    
         <div> 
  <li><a href="/about">about</a></li></div>
</ul>
  

</div></header>
    <span id="btn-list" onclick="turnList()">></span>
<div id="list" class="off">
<h2>Posts List</h2>

    <h5>
    <a href="/blog/2015/04/23/half-way-conclusion-of-3rd-grade-in-college/">Half Way Conclusion of 3rd Grade in College</a>
    <span>April 23, 2015</span>  
    </h5>

    <h5>
    <a href="/blog/2015/04/05/gityuan-cheng-dai-ma-guan-li-,sshhuan-shi-https/">git远程代码管理，SSH还是HTTPS</a>
    <span>April  5, 2015</span>  
    </h5>

    <h5>
    <a href="/blog/2015/04/05/moving-my-blog-to-octopress/">Moving My Blog to Octopress</a>
    <span>April  5, 2015</span>  
    </h5>

    <h5>
    <a href="/blog/2015/03/25/Monster-Storm/">Monster Storm</a>
    <span>March 25, 2015</span>  
    </h5>

    <h5>
    <a href="/blog/2015/03/23/Review_Vcool-Website/">Review VCool Website</a>
    <span>March 23, 2015</span>  
    </h5>

    <h5>
    <a href="/blog/2015/03/22/Morris-Traversal/">Morris Traversal</a>
    <span>March 22, 2015</span>  
    </h5>

    <h5>
    <a href="/blog/2015/03/20/douban-paper-test/">豆瓣笔试</a>
    <span>March 20, 2015</span>  
    </h5>

    <h5>
    <a href="/blog/2014/12/20/Distinct-Subsequences/">LeetCode上面的Distinct Subsequences总结</a>
    <span>December 20, 2014</span>  
    </h5>

    <h5>
    <a href="/blog/2014/11/25/Word-Ladder/">LeetCode上面的WordLadder总结</a>
    <span>November 25, 2014</span>  
    </h5>

    <h5>
    <a href="/blog/2014/11/14/Linux-File-System/">Linux文件系统基础</a>
    <span>November 14, 2014</span>  
    </h5>

    <h5>
    <a href="/blog/2014/10/15/First-Blog/">第一篇博客</a>
    <span>October 15, 2014</span>  
    </h5>

    <h5>
    <a href="/blog/2014/03/03/Hello-World/">Markdown Style Guide</a>
    <span>March  3, 2014</span>  
    </h5>

</div>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Monster Storm</h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-03-25T00:00:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


<div class="entry-content"><p>Monster Storm</p>

<p>边学边写的cocos2d-x游戏,基于3.0版本</p>

<p>这个游戏的主要难点有两个
1. 怎么把所有需要消除的精灵摆对位置
2. 怎么找到某个精灵周围的同类精灵</p>

<h2>摆放精灵</h2>

<ol>
<li>找到精灵摆放点的左下角的(x,y)坐标,这里直接借用<a href="http://www.tairan.com/archives/5929">泰然网教程上说的</a></li>
</ol>


<blockquote><p><img src="/images/1.png"></p></blockquote>

<p>m_matrixLeftBottomX的值 ＝ （ 屏幕的宽 － 寿司的宽＊N个寿司 － （ N-1 ）＊寿司之间的间隙） ／ 2。</p>

<ol>
<li>从下到上,从左到右遍历整个matrix,为每个精灵编号,例如,左下角的精灵行号0,列号0……这样每个精灵都有了一个坐标,而每个坐标对应了屏幕上的一个位置,只需要根据左下角的坐标加加减减就可以得到某个坐标对应的具体位置,这样就建立了坐标和精灵,坐标和图上的位置分别以一对应的关系.</li>
<li>有了上面一一对应的关系,只要在对应位置的上空XX米创建出来精灵,并把它移到对应位置就可以了</li>
</ol>


<h2>查找并消除精灵</h2>

<ol>
<li>定位到用户点击的精灵,想完成消灭小星星的消除,首先要知道用户点了那个精灵,这里我当时写的算法很low,是先获取用户点击的坐标,然后遍历整个精灵matrix,看一下哪个精灵所在的square包含了那个坐标就是点击的坐标,当然,已经被消除了的精灵是不在那个matrix里面的;

<ul>
<li>比较好的一个做法应该是根据点击的坐标和左下角的距离关系直接找出对应的位置,然后检查该位置是否有精灵..</li>
</ul>
</li>
<li>定位完了就要找该精灵周边同类的精灵了,寻找过程类似于深度优先遍历,我是用递归写的,比如对于定位到的精灵,分别找它上下左右的精灵,如果上下左右的精灵是同类的话,就加入list,并更新上下左右的精灵为当前的精灵,继续递归查找上下左右.注意:查找的过程要注意重复,每次找到新的都要判断一下是否已经找过当前精灵..

<ul>
<li>当前另一个想法是类似于广度优先遍历,,用一个队列来维护,广度优先的好处是避免了递归</li>
</ul>
</li>
<li>然后要判断一下用户的第二次点击,点击的是不是第一次点的那个区域,判断的方法就是得到第二次点击的精灵(的地址),和已经存到list(第一次点击之后的所有同类精灵)里面的所有精灵进行比较,如果有相同的,则True,不是就False,清空list,blabla&hellip;</li>
<li>点击完了,也消除完了相应的精灵,要完成上面精灵的下落和精灵列的左移,这在<a href="http://www.tairan.com/archives/5929">泰然教程</a>上面说的很清楚</li>
</ol>


<blockquote><p><img src="/images/2.png"></p></blockquote>

<p>注意由于游戏不同,这里只有过程一,也就是不必填充,只让上面的下落:对于每一列从下到上查找空白数,等到了空白数大于0就说明精灵要下落了</p>

<blockquote><pre><code>  // 从下向上
    for (int row = 0; row &lt; m_height; row++) {
        sushi = m_matrix[row * m_width + col];
        if (NULL == sushi) {
            removedSushiOfCol++;
        } else {
            if (removedSushiOfCol &gt; 0) {
                //计算寿司精灵的新行数
                }
        }
    }
</code></pre></blockquote>

<p>让精灵列左移也是,从左到右,只要检查每列的第一个元素是否为NULL即可,然后整列左移</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Harry</span></span>

      








  


<time datetime="2015-03-25T00:00:00+08:00" pubdate data-updated="true"></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/cocos2d-x/'>cocos2d-x</a>, <a class='category' href='/blog/categories/review/'>review</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://d-w-.github.io/blog/2015/03/25/Monster-Storm/" data-via="" data-counturl="http://d-w-.github.io/blog/2015/03/25/Monster-Storm/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2015/03/23/Review_Vcool-Website/" title="Previous Post: Review VCool Website">&laquo; Review VCool Website</a>
      
      
        <a class="basic-alignment right" href="/blog/2015/04/05/moving-my-blog-to-octopress/" title="Next Post: Moving my blog to Octopress">Moving my blog to Octopress &raquo;</a>
      
    </p>
  </footer>
</article>

</div>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Harry -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

<p>
<span class="credit">Powered by <a href="http://octopress.org">Octopress</a> using the <a href="https://github.com/fapper/classic-martinb">classic-martinb</a> theme</span>
</p>
</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
