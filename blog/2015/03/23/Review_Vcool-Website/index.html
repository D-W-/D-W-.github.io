
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Review VCool Website - D W</title>
  <meta name="author" content="Harry">

  
  <meta name="description" content="以前做过的一些东西的简单回顾，避免面试官问起来都忘了，也能在简历上面写得更加得心应手 python web.py 网站 接入新浪微博SDK，通过向新浪微博提供的接口(网址)发送GET请求(包含uid和code)得到json格式的返回数据 通过新浪SDK获取需要的信息的步骤 用户登陆我的网站, &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://d-w-.github.io/blog/2015/03/23/Review_Vcool-Website">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="D W" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <script src="/javascripts/dawnfan.js" type="text/javascript"></script>
  <script src="/javascripts/jquery.nicescroll.min.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   class="no-sidebar"  >
  <header role="banner"><a id="avatar" href="/about"><img src="/images/icon.jpg" alt="avatar"></a>
<div class="header-left">
  <hgroup>
  <h1><a href="/">D W</a></h1>
  
  <div class="subtitle">
    <h2>Brick walls are there for a reason, they let us prove how badly we want things.</h2>
  </div>
  
  </hgroup>
  
</div>

<div class="header-right">
  <ul class="main-navigation">
 <div> 
  <li><a href="/">blog</a></li></div>
         <div> 
  <li><a href="/blog/archives">archives</a></li></div>    
         <div> 
  <li><a href="/about">about</a></li></div>
</ul>
  

</div></header>
    <span id="btn-list" onclick="turnList()">></span>
<div id="list" class="off">
<h2>Posts List</h2>

    <h5>
    <a href="/blog/2015/08/14/reading-computer-systems-a-programmers-perspective-1/">Reading Computer Systems a Programmers Perspective 1</a>
    <span>August 14, 2015</span>  
    </h5>

    <h5>
    <a href="/blog/2015/04/23/half-way-conclusion-of-3rd-grade-in-college/">Half Way Conclusion of 3rd Grade in College</a>
    <span>April 23, 2015</span>  
    </h5>

    <h5>
    <a href="/blog/2015/04/05/gityuan-cheng-dai-ma-guan-li-,sshhuan-shi-https/">git远程代码管理，SSH还是HTTPS</a>
    <span>April  5, 2015</span>  
    </h5>

    <h5>
    <a href="/blog/2015/04/05/moving-my-blog-to-octopress/">Moving My Blog to Octopress</a>
    <span>April  5, 2015</span>  
    </h5>

    <h5>
    <a href="/blog/2015/03/25/Monster-Storm/">Monster Storm</a>
    <span>March 25, 2015</span>  
    </h5>

    <h5>
    <a href="/blog/2015/03/23/Review_Vcool-Website/">Review VCool Website</a>
    <span>March 23, 2015</span>  
    </h5>

    <h5>
    <a href="/blog/2015/03/22/Morris-Traversal/">Morris Traversal</a>
    <span>March 22, 2015</span>  
    </h5>

    <h5>
    <a href="/blog/2015/03/20/douban-paper-test/">豆瓣笔试</a>
    <span>March 20, 2015</span>  
    </h5>

    <h5>
    <a href="/blog/2014/12/20/Distinct-Subsequences/">LeetCode上面的Distinct Subsequences总结</a>
    <span>December 20, 2014</span>  
    </h5>

    <h5>
    <a href="/blog/2014/11/25/Word-Ladder/">LeetCode上面的WordLadder总结</a>
    <span>November 25, 2014</span>  
    </h5>

    <h5>
    <a href="/blog/2014/11/14/Linux-File-System/">Linux文件系统基础</a>
    <span>November 14, 2014</span>  
    </h5>

    <h5>
    <a href="/blog/2014/10/15/First-Blog/">第一篇博客</a>
    <span>October 15, 2014</span>  
    </h5>

    <h5>
    <a href="/blog/2014/03/03/Hello-World/">Markdown Style Guide</a>
    <span>March  3, 2014</span>  
    </h5>

</div>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Review VCool Website</h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-03-23T00:00:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


<div class="entry-content"><p>以前做过的一些东西的简单回顾，避免面试官问起来都忘了，也能在简历上面写得更加得心应手</p>

<h2>python web.py 网站</h2>

<p>接入新浪微博SDK，通过向新浪微博提供的接口(网址)发送GET请求(包含uid和code)得到json格式的返回数据</p>

<p>通过新浪SDK获取需要的信息的步骤</p>

<ol>
<li>用户登陆我的网站,点击新浪微博登陆,调到新浪的登陆页面,其中附带有GET的参数 <strong>redirect_uri</strong> ,用于下一步跳回我的网站</li>
<li>登陆成功返回我的网站,同时带有GET参数code&hellip;</li>
<li>我用code通过POST方法向新浪申请token,新浪返回一个json格式的数据,里面有token</li>
</ol>


<p>基本上面三个总结成一句话,我通过和新浪协商好的token向新浪指定的接口(网站)请求我想要的信息</p>

<p><strong>实际上,向新浪微博API请求微博等服务的时候只有<strong>access_token</strong>这一个参数是必须的,并不需要用户名等其他参数</strong></p>

<p>每次都让用户登录一下执行上面的步骤太麻烦,所以必须把token存起来,每次要用的时候直接通过token向接口请求就好了,token使用cookie保存,存在用户端,是我加密好了的值,我在数据库存另存一份用于比对,用户每次登录我就向用户的浏览器请求token(web.cookies().get()),解密之后得到里面的用户id和存好的token就可以向客户端请求了.</p>

<p>有了上面这些基础知识,就可以详细的理解整个网站的处理流程了</p>

<ol>
<li>用户访问VCool主页,由index这个类的GET()方法处理,首先向浏览器请求cookie,如果得到了cookie,直接跳到第3步,没有cookie,执行第2步</li>
<li>用户的浏览器并没有保存cookie,只能给他看主页,等他点击&#8221;通过新浪微博登陆&#8221;的按钮进行登录,等他在新浪端登陆完了,回来之后的处理是由callback类进行处理的(就是上面所说的给新浪登陆页面提供的 <strong>redirect_uri</strong> 填的是&#8217;<a href="http://1.vcoool.sinaapp.com/callback">http://1.vcoool.sinaapp.com/callback</a>&#8217;)</li>
<li>这种情况是用户的浏览器保存了cookie,按理说可以直接<code>raise web.seeother(\callback)</code>交给callback处理,因为callback是专门处理登陆后流程的类,但是这样的话会显示<strong>此网页包含重定向循环</strong>,我也不知道为啥..所以进行下列处理

<ol>
<li>通过在cookie里面解码出来的access_token构建一个请求对象</li>
<li>调用新浪微博API请求用户所关注用户的最新50条微博</li>
<li>对API返回的json格式数据处理(因为返回的东西有很多,我们只需要有限的信息比如微博内容,图片,作者等..)
4 .使用已经保存到数据库的SVM函数(在callback中已经保存,因为这里浏览器都存了cookie,所以之前肯定已经登录过了)计算得到分类的权值,并进行排序</li>
<li>字符串处理,因为新浪API返回的是raw字符串,@,##,和链接都不会显示,这里进行正则替换,把他们转换成HTML超链接形式</li>
<li>把排好序的微博列表通过<code>render.list()</code>方法传入前端模板</li>
</ol>
</li>
</ol>


<p>callback对象的功能</p>

<p>callback对象是对用户第一次登陆VCool进行处理,就像上面说的,用户在新浪的登陆页面登陆结束后就会redirect到这个函数来处理,同时会用GET方法附带一个code参数,用于我们请求access_token</p>

<ol>
<li>接收GET过来的code参数值,没有的话跳转到首页&#8221;/&#8221;</li>
<li>通过code向新浪请求参数access_token,expires_in,uid,分别是调用API时要用到的参数,过期时间,登录用户的新浪ID</li>
<li>根据上面得到的uid(新浪ID)查询一下数据库,如果已经有了相应的项的话就进行更新,如果没有的话就新建一个列表项</li>
<li>存cookie,把得到的access_token和expired_in等信息加密存一下cookie,以便下一次使用</li>
<li>后面的功能和3.2-3.6一样了</li>
</ol>


<p>当前数据库:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>data(weibo_id,reposts,comments,attitudes,text,pic_urls)
</span><span class='line'>    用户喜欢的微博训练集(把用户评论过的微博当做训练集)
</span><span class='line'>dislike(weibo_id,reposts,comments,attitudes,text,pic_urls)
</span><span class='line'>    用户不喜欢的微博训练集(把用户删除的微博当做训练集)
</span><span class='line'>func(weibo_id   a1  a2  a3  a4  a5  b)
</span><span class='line'>    SVM得到的超平面公式
</span><span class='line'>user(weixin_id,weibo_id,access_token,expires_in)
</span><span class='line'>    存储微博账号对应的微信号,连接微博api需要的access_token</span></code></pre></td></tr></table></div></figure>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Harry</span></span>

      








  


<time datetime="2015-03-23T00:00:00+08:00" pubdate data-updated="true"></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/python/'>python</a>, <a class='category' href='/blog/categories/review/'>review</a>, <a class='category' href='/blog/categories/web-dot-py/'>web.py</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://d-w-.github.io/blog/2015/03/23/Review_Vcool-Website/" data-via="" data-counturl="http://d-w-.github.io/blog/2015/03/23/Review_Vcool-Website/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2015/03/22/Morris-Traversal/" title="Previous Post: Morris Traversal">&laquo; Morris Traversal</a>
      
      
        <a class="basic-alignment right" href="/blog/2015/03/25/Monster-Storm/" title="Next Post: Monster Storm">Monster Storm &raquo;</a>
      
    </p>
  </footer>
</article>

</div>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Harry -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

<p>
<span class="credit">Powered by <a href="http://octopress.org">Octopress</a> using the <a href="https://github.com/fapper/classic-martinb">classic-martinb</a> theme</span>
</p>
</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
